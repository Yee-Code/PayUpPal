# Pay-Up Pal

## Telegram Bot 功能

1. **開始遊戲**：
   - 房主輸入 `/start`，Bot 初始化遊戲並分配起始資金。

2. **擲骰子與移動**：
   - 當前玩家輸入 `/roll`，Bot 隨機生成 2-12 的骰子點數，並移動玩家位置，觸發該格子事件。

3. **地產管理**：
   - `/buy`：購買當前位置的地產（若無主）。
   - `/upgrade`：升級當前地產（需為自己所有且未抵押）。
   - `/sell <地名>`：賣出指定地產（需先降級至0級）。
   - `/downgrade <地名>`：降級指定地產（返還房屋費用）。
   - `/mortgage <地名>`：抵押指定地產（需為0級）。
   - Bot 會自動處理租金支付與破產。

4. **機會與命運**：
   - 玩家停在「機會」或「命運」格時，Bot 會抽卡並顯示內容（目前僅顯示，尚未實作效果）。

5. **監獄機制**：
   - 玩家進入監獄需等待數回合或用 `/pay` 支付罰金脫離。

6. **破產與結束**：
   - 玩家資金為負時自破產。只剩一人時遊戲結束。

7. **遊戲重置**：
   - 房主可用 `/reset` 重置遊戲，所有玩家需重新 `/join`。

8. **資訊查詢**：
   - `/info`：顯示自己資訊（現金、地產、抵押地產、欠款）。
   - `/richlist`：顯示所有玩家現金狀態。
   - `/board`：顯示目前遊戲板狀態。

---

## 指令一覽

- `/join`：加入遊戲
- `/start`：開始遊戲
- `/roll`：擲骰子
- `/buy`：購買地產
- `/upgrade`：升級地產（當前位置）
- `/sell <地名>`：賣出地產
- `/downgrade <地名>`：降級地產
- `/mortgage <地名>`：抵押地產
- `/pay`：支付罰金或欠款
- `/next`：結束回合，輪到下一位
- `/info`：顯示自己資訊
- `/richlist`：顯示所有玩家財富
- `/board`：顯示遊戲板
- `/reset`：重置遊戲

---

## 技術實現

- **Bot 框架**：使用 `python-telegram-bot`，每個群組（chat_id）有獨立的 [`GameState`](game_state.py) 與 asyncio.Lock，確保同時只會有一個指令在執行。
- **狀態管理**：所有遊戲狀態皆由 [`GameState`](game_state.py) 管理，包含玩家、棋盤、回合、地產、欠款等。
- **棋盤設計**：由 [`board.py`](board.py) 初始化，支援地產、監獄、起點等格子。
- **地產與玩家**：物件導向設計，詳見 [`base.py`](base.py)。
- **機會卡**：由 [`chance.py`](chance.py) 提供，尚未完全實作效果。
- **遊戲數值**：由 [`game_setting.py`](game_setting.py) 定義。
- **指令同步**：所有指令皆經過鎖保護，避免多玩家同時操作造成狀態錯亂。
- **訊息處理**：Bot 會根據遊戲狀態自動提示玩家可執行的動作與狀態。

---

## 其他

- 目前尚未接入資料庫（如 SQLite），所有狀態皆在記憶體中。
- 支援多群組同時遊戲，互不影響。
- 破產、升級、抵押等規則已基本實作，細節可參考 [`game_state.py`](game_state.py)。
- 未來可依需求擴充地圖、事件、UI 或多語系等功能。
- 核心邏輯定義在 [`game_state.py`](game_state.py)，可依不同平台或需求進行擴展。
