# Pay-Up Pal

## 遊戲基本架構

- **玩家人數**：2-6 人（可根據需求調整）
- **地圖**：一個循環的地圖，包含不同類型的格子，例如：
  - 地產（可購買並收取租金）
  - 機會（抽取隨機正面或負面效果）
  - 命運（類似機會，但效果更具變化）
  - 監獄（限制玩家行動）
  - 起點（經過時獲得獎勵）
- **貨幣**：遊戲內虛擬貨幣，玩家用於購買地產、支付租金或罰金
- **勝利條件**：最後一個未破產的玩家獲勝

---

## Telegram Bot 的功能

為了讓遊戲順利進行，Telegram Bot 將提供以下功能，並透過指令操作：

1. **玩家註冊**：
   - 玩家在群組中輸入 `/join` 加入遊戲。
   - Bot 會記錄參與者，直到房主開始遊戲。

2. **開始遊戲**：
   - 房主輸入 `/start`，Bot 初始化遊戲並分配起始資金（例如每人 1500 單位貨幣）。

3. **擲骰子與移動**：
   - 每回合，當前玩家輸入 `/roll`，Bot 隨機生成 1-6 的骰子點數，並根據點數移動玩家位置。
   - Bot 會顯示玩家的新位置並觸發該格子的事件。

4. **地產管理**：
   - **購買**：若玩家停在無主的地產格子上，可輸入 `/buy` 購買。
   - **租金**：若停在他人地產上，Bot 自動扣除租金並轉給地產擁有者。

5. **機會與命運**：
   - 當玩家停在「機會」或「命運」格子上，Bot 隨機抽取一張卡片並執行效果，例如：
     - 獲得或失去金錢
     - 移動到指定位置
     - 被送進監獄

6. **監獄機制**：
   - 玩家被送進監獄後，需支付罰金（例如 50 單位貨幣）或等待 3 回合才能離開。
   - 可輸入 `/pay` 支付罰金以立即脫離。

7. **破產與結束**：
   - 若玩家資金為負，Bot 宣布其破產並退出遊戲。
   - 當只剩一名玩家時，Bot 宣布該玩家獲勝並結束遊戲。

---

## 遊戲流程

### 1. 遊戲初始化

- 房主創建遊戲並設定參數（例如玩家人數）。
- 玩家透過 `/join` 加入，Bot 確認參與者名單。
- 房主輸入 `/start` 後，遊戲開始，每人獲得起始資金。

### 2. 玩家回合

- 輪到某玩家時，Bot 提示該玩家輸入 `/roll`。
- Bot 顯示骰子點數並移動玩家至新位置。
- 根據格子類型，執行以下動作：
  - **地產**：未擁有時可購買，已擁有時支付租金。
  - **機會/命運**：抽卡並執行效果。
  - **監獄**：進入監獄，需支付罰金或等待。
- 玩家完成行動後，輪到下一位玩家。

### 3. 遊戲結束

- 當只剩一名未破產的玩家時，Bot 宣布其為勝者並結束遊戲。

---

## 技術實現建議

- **資料庫**：使用 SQLite 或 MongoDB 儲存遊戲狀態，包括：
  - 玩家資金與位置
  - 地產擁有權與租金資訊
  - 當前輪到哪位玩家
- **Bot 框架**：使用 Python 的 `python-telegram-bot` 庫開發。
- **指令處理**：定義以下指令：
  - `/join`：加入遊戲
  - `/start`：開始遊戲
  - `/roll`：擲骰子
  - `/buy`：購買地產
  - `/pay`：支付罰金（用於監獄）
  - `/richlist`: 顯示玩家目前財富狀態 （現金、地產）
- **狀態管理**：維護一個遊戲對象，追蹤所有玩家的狀態和地圖資訊。
- **程式架構**: 使用高級物件導向實作

---

## 挑戰與解決方案

1. **多玩家同步**：
   - **問題**：Telegram 是異步環境，多人同時輸入指令可能導致混亂。
   - **解決方案**：使用鎖機制或指令隊列，確保每次只處理一個玩家的行動。

2. **遊戲進度緩慢**：
   - **問題**：玩家可能因離線而拖延遊戲。
   - **解決方案**：設定回合超時（例如 1 分鐘），超時後自動跳過該玩家。

3. **地圖平衡**：
   - **問題**：某些地產可能過強，影響公平性。
   - **解決方案**：參考經典大富翁地圖設計，並透過測試調整地產價格與租金。

---

## 未來擴展建議

- **地產升級**：允許玩家升級地產（例如建造房屋），提高租金收入。
- **交易系統**：加入 `/trade` 指令，讓玩家之間交易地產。
- **AI 玩家**：增加 AI 對手，支援單人模式。

